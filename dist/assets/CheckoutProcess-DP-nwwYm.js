import{g as a,a as c}from"./utils-C4nQLX5g.js";import{E as n}from"./ExternalServices-Cf4cu-NQ.js";const l=new n;function h(i){const e=new FormData(i),t={};return e.forEach((o,s)=>{t[s]=o}),t}function m(i){return i.map(t=>(console.log(t),{id:t.Id,price:t.FinalPrice,name:t.Name,quantity:1}))}class d{constructor(e,t){this.key=e,this.outputSelector=t,this.list=[],this.itemTotal=0,this.shipping=0,this.tax=0,this.orderTotal=0}init(){this.list=a(this.key),this.calculateItemSummary()}calculateItemSummary(){const e=document.querySelector(this.outputSelector+" #cartTotal"),t=document.querySelector(this.outputSelector+" #num-items");t.innerText=this.list.length;const o=this.list.map(s=>s.FinalPrice);this.itemTotal=o.reduce((s,r)=>s+r),e.innerText=`$${this.itemTotal}`}calculateOrderTotal(){this.tax=this.itemTotal*.06,this.shipping=10+(this.list.length-1)*2,this.orderTotal=parseFloat(this.itemTotal)+parseFloat(this.tax)+parseFloat(this.shipping),this.displayOrderTotals()}displayOrderTotals(){const e=document.querySelector(`${this.outputSelector} #tax`),t=document.querySelector(`${this.outputSelector} #shipping`),o=document.querySelector(`${this.outputSelector} #orderTotal`);e.innerText=`$${this.tax.toFixed(2)}`,t.innerText=`$${this.shipping.toFixed(2)}`,o.innerText=`$${this.orderTotal.toFixed(2)}`}async checkout(){var o;const e=document.forms.checkout,t=h(e);t.orderDate=new Date().toISOString(),t.orderTotal=this.orderTotal,t.tax=this.tax,t.shipping=this.shipping,t.items=m(this.list);try{const s=await l.checkout(t);localStorage.removeItem("so-cart"),window.location.href="success.html"}catch(s){const r=((o=s.message)==null?void 0:o.message)||s.message||"An error occurred. Please try again.";c(r)}}}export{d as C};
